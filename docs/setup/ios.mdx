---
title: iOS Setup  
description: "Configure iOS background processing with BGTaskScheduler"
---

# iOS Setup

Configure your iOS app to support background tasks using BGTaskScheduler and Background Fetch APIs.

## Step 1: Enable Background Modes

In Xcode, select your target and go to **Signing & Capabilities**:

1. Click **+ Capability**
2. Add **Background Modes**  
3. Check **Background processing** and **Background fetch**

<div style={{textAlign: 'center', margin: '20px 0'}}>
  <img src="/.art/ios_background_mode_background_processing.png" alt="iOS Background Modes" style={{maxWidth: '100%'}} />
</div>

This adds to your `Info.plist`:
```xml Info.plist  
<key>UIBackgroundModes</key>
<array>
    <string>processing</string>
    <string>fetch</string>
</array>
```

## Step 2: Register Task Identifiers

Add your task identifiers to `Info.plist`:

```xml Info.plist
<key>BGTaskSchedulerPermittedIdentifiers</key>
<array>
    <string>dev.yourapp.data_sync</string>
    <string>dev.yourapp.file_upload</string>
    <!-- Add your task identifiers here -->
</array>
```

## Step 3: Configure AppDelegate.swift

```swift ios/Runner/AppDelegate.swift
import Flutter
import UIKit
import workmanager

@UIApplicationMain
@objc class AppDelegate: FlutterAppDelegate {
  override func application(
    _ application: UIApplication,
    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
  ) -> Bool {
    GeneratedPluginRegistrant.register(with: self)
    
    // Register background tasks
    WorkmanagerPlugin.registerBGProcessingTask(withIdentifier: "dev.yourapp.data_sync")
    
    // For periodic tasks (iOS 13+)
    WorkmanagerPlugin.registerPeriodicTask(
      withIdentifier: "dev.yourapp.periodic_sync", 
      frequency: NSNumber(value: 20 * 60) // 20 minutes in seconds
    )
    
    return super.application(application, didFinishLaunchingWithOptions: launchOptions)
  }
}
```

## Task Types and Setup

<Tabs>
  <Tab title="One-Off Tasks">
    **Use for**: Immediate background work (uploads, quick sync)
    
    **Characteristics:**
    - Starts immediately when scheduled
    - Limited to ~30 seconds execution time
    - No additional setup needed in AppDelegate

    ```dart
    Workmanager().registerOneOffTask(
      "upload_task",
      "file_upload",
      constraints: Constraints(networkType: NetworkType.connected),
    );
    ```
  </Tab>

  <Tab title="Periodic Tasks">
    **Use for**: Regular data sync, maintenance tasks
    
    **Setup required in AppDelegate.swift:**
    ```swift
    WorkmanagerPlugin.registerPeriodicTask(
      withIdentifier: "dev.yourapp.sync_task", 
      frequency: NSNumber(value: 60 * 60) // 1 hour
    )
    ```

    **Info.plist:**
    ```xml
    <key>BGTaskSchedulerPermittedIdentifiers</key>
    <array>
        <string>dev.yourapp.sync_task</string>
    </array>
    ```

    **Schedule in Dart:**
    ```dart
    Workmanager().registerPeriodicTask(
      "dev.yourapp.sync_task",
      "periodic_sync", 
      frequency: Duration(hours: 1), // Ignored on iOS - set in AppDelegate
    );
    ```
  </Tab>

  <Tab title="Processing Tasks">
    **Use for**: Long-running tasks (large uploads, heavy processing)
    
    **Setup in AppDelegate.swift:**
    ```swift
    WorkmanagerPlugin.registerBGProcessingTask(withIdentifier: "dev.yourapp.heavy_task")
    ```

    **Characteristics:**
    - Can run for minutes
    - Only when device is idle and charging
    - iOS may defer execution significantly

    ```dart
    Workmanager().registerProcessingTask(
      "dev.yourapp.heavy_task",
      "heavy_processing",
      constraints: Constraints(
        requiresCharging: true,
        networkType: NetworkType.connected,
      ),
    );
    ```
  </Tab>
</Tabs>

## iOS Limitations & Best Practices

<Warning>
iOS background processing has strict limitations that don't exist on Android:
</Warning>

### Execution Time Limits
- **One-off tasks**: ~30 seconds
- **Periodic tasks**: ~30 seconds  
- **Processing tasks**: Several minutes (when device idle + charging)

### Scheduling Restrictions
- iOS learns user patterns and schedules accordingly
- Tasks may not run if user hasn't used app recently
- Background App Refresh must be enabled
- No guaranteed execution time

### Best Practices

<AccordionGroup>
  <Accordion title="Keep Tasks Short">
    ```dart
    Future<bool> _quickSync() async {
      final startTime = DateTime.now();
      
      try {
        // Your sync logic here
        await syncData();
        
        // Check if we're running out of time
        final elapsed = DateTime.now().difference(startTime);
        if (elapsed.inSeconds > 25) {
          print('Task taking too long, stopping early');
          return false; // Retry later
        }
        
        return true;
      } catch (e) {
        return false;
      }
    }
    ```
  </Accordion>

  <Accordion title="Handle Task Expiration">
    ```dart
    Future<bool> _handleTaskExpiration() async {
      final completer = Completer<bool>();
      
      // Start your work
      final workFuture = performWork();
      
      // Set a timeout slightly less than iOS limit
      final timeoutFuture = Future.delayed(
        Duration(seconds: 25), 
        () => false
      );
      
      try {
        final result = await Future.any([workFuture, timeoutFuture]);
        return result;
      } catch (e) {
        return false;
      }
    }
    ```
  </Accordion>

  <Accordion title="Incremental Processing">
    ```dart
    Future<bool> _incrementalSync() async {
      final prefs = await SharedPreferences.getInstance();
      final lastSyncPoint = prefs.getString('last_sync_point') ?? '0';
      
      // Only sync what's new since last successful sync
      final response = await api.getSince(lastSyncPoint);
      
      if (response.isSuccess) {
        await prefs.setString('last_sync_point', response.nextSyncPoint);
        return true;
      }
      
      return false;
    }
    ```
  </Accordion>
</AccordionGroup>

## Testing on iOS

### Debug in Simulator
Background tasks **cannot** be tested in iOS Simulator. Use a physical device.

### Debug Commands
Use Xcode debugger console to trigger tasks:

```objc
// Trigger background app refresh
e -l objc -- (void)[[BGTaskScheduler sharedScheduler] _simulateLaunchForTaskWithIdentifier:@"dev.yourapp.sync_task"]

// Trigger processing task  
e -l objc -- (void)[[BGTaskScheduler sharedScheduler] _simulateLaunchForTaskWithIdentifier:@"dev.yourapp.heavy_task"]
```

### Monitor Background Execution
```dart
// Print scheduled tasks (iOS 13+ only)
if (Platform.isIOS) {
  final tasks = await Workmanager().printScheduledTasks();
  print('Scheduled tasks: $tasks');
}
```

## Troubleshooting

<AccordionGroup>
  <Accordion title="Tasks Never Run">
    **Check:**
    - Background App Refresh is enabled in iOS Settings
    - Task identifiers match between Info.plist and AppDelegate.swift
    - App has been used recently (iOS learning algorithm)
    - Device has been idle/charging (for processing tasks)
  </Accordion>

  <Accordion title="Tasks Stop Working">
    **Common causes:**
    - User disabled Background App Refresh
    - App hasn't been used in several days
    - iOS battery optimization kicked in
    - Task is taking too long and being terminated
  </Accordion>

  <Accordion title="Compilation Errors">
    **Make sure:**
    - `import workmanager` is added to AppDelegate.swift
    - iOS deployment target is 10.0+ in Podfile
    - Xcode version is 10.3+ (Swift 4.2+)
  </Accordion>
</AccordionGroup>

## Next Steps

<CardGroup cols={2}>
  <Card title="Use Cases" icon="list-check" href="/usecases/data-sync">
    See platform-specific examples
  </Card>
  <Card title="Debugging" icon="bug" href="/debugging/overview">
    Learn to debug background tasks
  </Card>
</CardGroup>